{% block contact %}
    <!-- Contact Section -->
    <section id="contact" class="contact section">

        <!-- Section Title -->
        <div class="container section-title" data-aos="fade-up">
            <h2>Contact</h2>
            <p>N'h√©sitez pas √† me contacter pour toute question ou opportunit√© de collaboration</p>
        </div><!-- End Section Title -->

        <div class="container" data-aos="fade-up" data-aos-delay="100">

            {# Flash Messages #}
            {% for flash_message in app.flashes('success') %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ flash_message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}

            {% for flash_message in app.flashes('warning') %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    {{ flash_message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}

            {% for flash_message in app.flashes('error') %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    {{ flash_message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}

            <div class="row gy-4">

                <div class="col-lg-5">
                    <div class="info-wrap">
                        {% if contactInfo %}
                            {% set hasContact = false %}
                            
                            {% if contactInfo.address %}
                                {% set hasContact = true %}
                                <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="200">
                                    <i class="bi bi-geo-alt flex-shrink-0"></i>
                                    <div>
                                        <h3>Adresse</h3>
                                        <p>{{ contactInfo.address }}</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if contactInfo.phone %}
                                {% set hasContact = true %}
                                <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="300">
                                    <i class="bi bi-telephone flex-shrink-0"></i>
                                    <div>
                                        <h3>T√©l√©phone</h3>
                                        <p>{{ contactInfo.phone }}</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if contactInfo.email %}
                                {% set hasContact = true %}
                                <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="400">
                                    <i class="bi bi-envelope flex-shrink-0"></i>
                                    <div>
                                        <h3>Email</h3>
                                        <p>{{ contactInfo.email }}</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% if not hasContact %}
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> 
                                    üì¨ <strong>Pr√™t √† √™tre contact√© ?</strong><br>
                                    Ajoutez votre adresse, t√©l√©phone ou email pour que vos visiteurs puissent vous joindre !
                                </div>
                            {% endif %}

                            {% if contactInfo.mapEmbedUrl %}
                                <iframe src="{{ contactInfo.mapEmbedUrl }}" 
                                        frameborder="0" 
                                        style="border:0; width: 100%; height: 270px;" 
                                        allowfullscreen="" 
                                        loading="lazy" 
                                        referrerpolicy="no-referrer-when-downgrade">
                                </iframe>
                            {% else %}
                                <div class="mt-3 p-3 bg-light rounded text-center text-muted">
                                    <i class="bi bi-map fs-2"></i>
                                    <p class="mb-0 mt-2">üó∫Ô∏è <em>Ajoutez une carte pour montrer votre localisation !</em></p>
                                </div>
                            {% endif %}

                        {% else %}
                            <div class="alert alert-info text-center p-4">
                                <i class="bi bi-person-plus fs-1 d-block mb-2"></i>
                                <h5>üì¨ Restons connect√©s !</h5>
                                <p class="mb-0">Configurez vos informations de contact pour permettre √† vos visiteurs de vous joindre facilement.</p>
                                <small class="d-block mt-2 text-muted">Administration > Contact Info</small>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-lg-7">
                    {{ form_start(form, {
                        'attr': {
                            'class': 'php-email-form', 
                            'data-aos': 'fade-up', 
                            'data-aos-delay': '200',
                            'id': 'contact-form'
                        }
                    }) }}
                        <div class="row gy-4">

                            <div class="col-md-6">
                                {{ form_label(form.name, 'Votre nom', {'label_attr': {'class': 'pb-2'}}) }}
                                {{ form_widget(form.name, {'attr': {'class': 'form-control', 'placeholder': 'Jean Dupont'}}) }}
                                {{ form_errors(form.name) }}
                            </div>

                            <div class="col-md-6">
                                {{ form_label(form.email, 'Votre email', {'label_attr': {'class': 'pb-2'}}) }}
                                {{ form_widget(form.email, {'attr': {'class': 'form-control', 'placeholder': 'jean@exemple.com'}}) }}
                                {{ form_errors(form.email) }}
                            </div>

                            <div class="col-md-12">
                                {{ form_label(form.subject, 'Sujet', {'label_attr': {'class': 'pb-2'}}) }}
                                {{ form_widget(form.subject, {'attr': {'class': 'form-control', 'placeholder': 'Collaboration, question, projet...'}}) }}
                                {{ form_errors(form.subject) }}
                            </div>

                            <div class="col-md-12">
                                {{ form_label(form.message, 'Votre message', {'label_attr': {'class': 'pb-2'}}) }}
                                {{ form_widget(form.message, {'attr': {'class': 'form-control', 'rows': '6', 'placeholder': 'D√©crivez votre projet ou votre question en d√©tail...'}}) }}
                                {{ form_errors(form.message) }}
                            </div>

                            <div class="col-md-12 text-center">
                                <div class="loading" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Envoi en cours...</span>
                                    </div>
                                    <p class="mt-2">Envoi en cours...</p>
                                </div>
                                
                                <div class="alert alert-danger error-message" style="display: none;" role="alert"></div>
                                <div class="alert alert-success sent-message" style="display: none;" role="alert">
                                    üéâ Votre message a √©t√© envoy√©. Merci !
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-send me-2"></i>Envoyer le message
                                </button>
                            </div>

                        </div>
                    {{ form_end(form) }}
                </div>

            </div>

        </div>

    </section><!-- /Contact Section -->

    {# Script pour g√©rer AJAX si besoin #}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('contact-form');
        const loading = form.querySelector('.loading');
        const errorMessage = form.querySelector('.error-message');
        const sentMessage = form.querySelector('.sent-message');
        const submitBtn = form.querySelector('button[type="submit"]');

        form.addEventListener('submit', function(e) {
            // Si Turbo est actif, laisser faire
            if (window.Turbo) return;
            
            e.preventDefault();
            
            loading.style.display = 'block';
            errorMessage.style.display = 'none';
            sentMessage.style.display = 'none';
            submitBtn.disabled = true;

            fetch('{{ path('app_contact_submit') }}', {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                submitBtn.disabled = false;

                if (data.success) {
                    sentMessage.style.display = 'block';
                    form.reset();
                } else {
                    errorMessage.textContent = data.message || 'Une erreur est survenue.';
                    errorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                submitBtn.disabled = false;
                errorMessage.textContent = 'Erreur de connexion. Veuillez r√©essayer.';
                errorMessage.style.display = 'block';
            });
        });
    });
    </script>
{% endblock %}